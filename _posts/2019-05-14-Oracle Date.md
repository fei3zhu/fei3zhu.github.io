---
layout: post
title: "Oracle Date 类型数据的那些事"
date: 2019-05-14 23:00:00 +0800
categories: Daily
tags: daily
img: ../images/blog/20190514/head.jpg
describe: Oracle Date 类型数据的各种处理方法
---

# 1.时间数据入库

```sql
--时间字符串 2019-05-14 10:49:43.0 入库
INSERT INTO TEST_TABLE 
	(DATE_COL) 
VALUES
	(CAST(TO_TIMESTAMP('2019-05-14 10:49:43.0','YYYY-MM-DD HH24:MI:SS.FF') AS DATE))
```

- 如果时间字符串为其他格式，可以调整时间字符串匹配值（YYYY-MM-DD HH24:MI:SS.FF）为其他的表达形式，如：“YYYYDDHH24MI”，可以匹配“2019141049”时间字符串

- 需要注意的是，由于Oracle不区分大小写，因此时间字符串匹配值的""月份""表示为"MM";“分钟”表示为“MI”

# 2.时间数据的加减法

```sql
--查询更新时间为25分钟前的数据
--时间线举例：PASTTIME------UPDATETIME--------SYSDATE-25/(24*60)-------SYSDATE
SELECT * FROM TEST_TABLE T WHERE T.UPDATETIME <= ( SYSDATE-25/(24*60) )
--查询更新时间为3小时前的数据
SELECT * FROM TEST_TABLE T WHERE T.UPDATETIME <= ( SYSDATE-3/(24) )
```

- 分母为“24”时，分子的数字表示含义为“小时”粒度，如果是“24*60”，分子的数字表示含义为“分钟”粒度，以此类推
- 时间的加减法操作还不仅于此，以下是一些常用例子：

```sql
--加法
--加1年
SELECT SYSDATE,ADD_MONTHS(SYSDATE,12) FROM DUAL;
--加1月
SELECT SYSDATE,ADD_MONTHS(SYSDATE,1) FROM DUAL;
--加1星期
SELECT SYSDATE,TO_CHAR(SYSDATE+7,'YYYY-MM-DD HH24:MI:SS') FROM DUAL;
--加1天
SELECT SYSDATE,TO_CHAR(SYSDATE+1,'YYYY-MM-DD HH24:MI:SS') FROM DUAL;
--加1小时
SELECT SYSDATE,TO_CHAR(SYSDATE+1/24,'YYYY-MM-DD HH24:MI:SS') FROM DUAL;
--加1分钟
SELECT SYSDATE,TO_CHAR(SYSDATE+1/24/60,'YYYY-MM-DD HH24:MI:SS') FROM DUAL;
--加1秒
SELECT SYSDATE,TO_CHAR(SYSDATE+1/24/60/60,'YYYY-MM-DD HH24:MI:SS') FROM DUAL;

--减法
--减1年
SELECT SYSDATE,ADD_MONTHS(SYSDATE,-12) FROM DUAL;
--减1月
SELECT SYSDATE,ADD_MONTHS(SYSDATE,-1) FROM DUAL;
--减1星期
SELECT SYSDATE,TO_CHAR(SYSDATE-7,'YYYY-MM-DD HH24:MI:SS') FROM DUAL;
--减1天
SELECT SYSDATE,TO_CHAR(SYSDATE-1,'YYYY-MM-DD HH24:MI:SS') FROM DUAL;
--减1小时
SELECT SYSDATE,TO_CHAR(SYSDATE-1/24,'YYYY-MM-DD HH24:MI:SS') FROM DUAL;
--减1分钟
SELECT SYSDATE,TO_CHAR(SYSDATE-1/24/60,'YYYY-MM-DD HH24:MI:SS') FROM DUAL;
--减1秒
SELECT SYSDATE,TO_CHAR(SYSDATE-1/24/60/60,'YYYY-MM-DD HH24:MI:SS') FROM DUAL;
```

# 3.特殊时间值的获取

- 获取当月第一天

```sql
SELECT TRUNC(SYSDATE,'MM') FROM DUAL;
```

- 获取当月天数

```sql
SELECT TO_CHAR(LAST_DAY(SYSDATE),'DD') DAYNUM FROM DUAL;
```

- 返回当前月份所有日期的集合

```sql
SELECT TO_DATE(B.FIRSTDATE, 'YYYY-MM-DD HH24:MI:SS') +
       (LEVEL - 1) * 1 DT_
  FROM DUAL,
       (SELECT TO_CHAR(LAST_DAY(SYSDATE), 'DD') DAYNUM FROM DUAL) A,
       (SELECT TO_CHAR(TRUNC(SYSDATE, 'MM'),'YYYY-MM-DD') FIRSTDATE FROM DUAL) B
CONNECT BY LEVEL <= A.DAYNUM
```

